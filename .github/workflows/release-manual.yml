name: Manual Release

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Release version (e.g., v1.2.0)'
        required: true
        default: 'v1.2.0'
      release_notes:
        description: 'Release notes'
        required: false
        default: |
          ## ğŸ‰ å›¾ç‰‡é‡å‘½åå·¥å…·æ›´æ–°
          
          ### ğŸ“¦ ä¸‹è½½å®‰è£…åŒ…
          - **Windows ç”¨æˆ·**: ä¸‹è½½ `.zip` æ–‡ä»¶
          - **Mac ç”¨æˆ·**: ä¸‹è½½å¯¹åº”æ¶æ„çš„ `.dmg` æ–‡ä»¶
            - Intel èŠ¯ç‰‡: `*_x64.dmg`
            - Apple Silicon (M1/M2): `*_arm64.dmg`
            - é€šç”¨ç‰ˆæœ¬: `*_universal.dmg`
          
          ### ğŸ“‹ å®‰è£…è¯´æ˜
          - **Windows**: è§£å‹ zip æ–‡ä»¶åè¿è¡Œ exe æ–‡ä»¶
          - **Mac**: ä¸‹è½½ dmg æ–‡ä»¶ï¼ŒåŒå‡»å®‰è£…åä»åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹å¯åŠ¨

jobs:
  create-release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check if release files exist
        run: |
          VERSION="${{ github.event.inputs.version }}"
          VERSION_NUM="${VERSION#v}"
          RELEASE_DIR="./release/${VERSION_NUM}"
          
          if [ ! -d "$RELEASE_DIR" ]; then
            echo "âŒ é”™è¯¯: æ‰¾ä¸åˆ°æ„å»ºç›®å½• $RELEASE_DIR"
            echo "è¯·å…ˆåœ¨æœ¬åœ°è¿è¡Œæ„å»ºå‘½ä»¤å¹¶æäº¤æ„å»ºæ–‡ä»¶ï¼š"
            echo "  pnpm run build:mac"
            echo "  pnpm run build:win"
            echo "  git add release/"
            echo "  git commit -m 'Add release builds for $VERSION'"
            echo "  git push"
            exit 1
          fi
          
          echo "âœ… æ‰¾åˆ°æ„å»ºç›®å½•: $RELEASE_DIR"
          ls -la "$RELEASE_DIR"

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ github.event.inputs.version }}
          name: ${{ github.event.inputs.version }} - å›¾ç‰‡é‡å‘½åå·¥å…·
          body: ${{ github.event.inputs.release_notes }}
          files: |
            release/**/*.dmg
            release/**/*.zip
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
